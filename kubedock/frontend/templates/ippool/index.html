{% extends "layout.html" %}

{% block head_extras %}
<link rel="stylesheet" href="/static/css/jquery-ui.css">
{% endblock %}

{% block body %}
    <style>
    ul#hosts-list { list-style-type: none; }
    </style>
    {% with items=MENU.navbar.get_items() %}
    {% include "inc/navbar_menu.html" %}
    {% endwith %}

    <div id="globalError"></div>
    <!-- contents container -->
    <div id="contents"></div>

    <script type="text/template" id="networks-list-template">
        <div id="networksList">
            <div class="breadcrumbs-wrapper">
                <div class="container breadcrumbs" id="breadcrumbs">
                    <ul class="breadcrumb">
                        <li class="active">
                            IP Pool
                        </li>
                    </ul>
                    <div class="control-group">
                        <button id="create_network">Add subnet</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li class="general active"><a href="{{ url_for('ippool.index') }}">IP pool</a></li>
                </ul>
            </div>
            <div id="details_content" class="col-sm-10">
                <div id="tab-content">
                    <table class="table table-bordered">
                    <thead><tr>
                        <th>Subnet</th>
                        <th>IP</th>
                    </tr></thead>
                    <tbody></tbody>
                    </table>
                <div>
            </div>
        </div>
    </script>

    <script type="text/template" id="network-create-template">
        <div id="createNetwork">
            <div class="breadcrumbs-wrapper">
                <div class="container breadcrumbs" id="breadcrumbs">
                    <ul class="breadcrumb">
                        <li>
                            <a href="{{ url_for('ippool.index') }}">IP Pool</a>
                        </li>
                        <li class="active">Add subnet</li>
                    </ul>
                </div>
            </div>
            <div id="network-contents" class="container">
                <div class="row">
                    <div id="network-controls" class="col-sm-9 col-sm-offset-3 no-padding">
                        <div class="form-group">
                            <label for="network">Subnet</label>
                            <input type="text" name="network" class="masked-ip" id="network" placeholder="1.2.3.4/32">
                        </div>
                        <div class="form-group">
                            <label for="network">Exclude IPs</label>
                            <input type="text" name="autoblock" class="" placeholder="eg 2,3,4 or 2-4 or both">
                        </div>
                    </div>
                    <div class="buttons pull-right">
                        <a class="gray" href="{{ url_for('ippool.index') }}">Cancel</a>
                        <button id="network-add-btn" type="submit">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script type="text/template" id="network-item-template">
        <% states = {
            free: 'text-success',
            busy: 'text-danger',
            blocked: 'text-warning'
        } %>

        <td>
            <%- network %>
            <button id="deleteNetwork" class="btn btn-danger btn-xs pull-right">
                <i class="glyphicon glyphicon-trash"></i>
            </button>
        </td>
        <td><ul id="hosts-list">
            <% _.each(allocation, function(itm){ %>
            <li class="<%- states[itm[2]] %>">
                <%- itm[0] %>: <%- itm[1] ? itm[1] : itm[2] %>
                <% if(itm[2] == 'busy') { %>
                <button class="btn btn-xs btn-link unbind_ip"
                        data-ip="<%- itm[0] %>">unbind</button>
                <% } else if(itm[2] == 'blocked') { %>
                <button class="btn btn-xs btn-link unblock_ip"
                        data-ip="<%- itm[0] %>">unblock</button>
                <% } else if(itm[2] == 'free') { %>
                <button class="btn btn-xs btn-link block_ip"
                        data-ip="<%- itm[0] %>">block</button>
                <% } %>
            </li>
            <% }); %>
        </ul></td>
    </script>

    <script type="text/template" id="networks-layout-template">
        <div id="main">main div text</div>
    </script>

    <script data-main="/static/js/ippool_app/require_main.js" src="/static/js/lib/require.js"></script>

    <script type="text/javascript">
    var networksCollection = {{ networks_collection|safe }};
    </script>

{% endblock %}
