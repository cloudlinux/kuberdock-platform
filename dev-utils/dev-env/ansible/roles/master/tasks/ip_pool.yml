---

- name: Calclulate IP excludes
  set_fact:
      excludes: "{{ range(1,255)|map('string')|difference(public_ips.split(','))|join(',') }}"
  when: is_nebula

- name: Create IP pool
  shell: python /vagrant/manage.py create-ip-pool -s "{{ (ansible_all_ipv4_addresses | last).split('.')[:3]|join('.')}}.0/24" -e {{ excludes | default('1-30')}}
